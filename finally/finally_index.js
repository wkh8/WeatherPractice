(()=>{"use strict";const e="https://n44t2at2rv.re.qweatherapi.com/v7/weather/7d?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",t=`https://n44t2at2rv.re.qweatherapi.com/v7/historical/weather?location=101010100&date=${function(){const e=new Date;return e.setDate(e.getDate()-1),[e.getFullYear(),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("")}()}&key=0f78c7eacd1d4118822553781c889ca8`;function a(e){return axios({url:e}).then(e=>e).catch(e=>{console.error(e)})}function n(e,t){if(e.startsWith("https")){let a=new URL(e);return a.searchParams.set("location",t),a.href}return e}requestAnimationFrame(()=>{setTimeout(()=>{document.querySelector(".see ul").classList.add("transition")},100)});let o=0;document.querySelector(".two_btn .right").addEventListener("click",function(){const e=document.querySelector(".see ul");o=o+1100>e.clientWidth-1200?e.clientWidth-1200:1100+o,e.style.transform=`translateX(-${o}px)`,console.log(o)}),document.querySelector(".two_btn .left").addEventListener("click",function(){const e=document.querySelector(".see ul");o-1100>0?o-=1100:o=0,e.style.transform=`translateX(-${o}px)`}),Chart.register(ChartDataLabels);let r=0;document.querySelector(".daily_left").addEventListener("click",function(){0!==r&&(r=0,document.querySelector(".daily_index ul").style.transform=`translateX(-${r}px)`)}),document.querySelector(".daily_right").addEventListener("click",function(){0===r&&(r=458,console.log(111),document.querySelector(".daily_index ul").style.transform=`translateX(-${r}px)`)});let c=JSON.parse(localStorage.getItem("default_last"))||{name:"陕西 西安",code:101110101,flag:!0},l=[];const i=document.querySelector(".search_city"),d=document.querySelector(".search_list"),s=document.querySelector(".search_list ul"),u=document.querySelector(".hot_city");i.addEventListener("focus",function(){u.style.display="block"}),i.addEventListener("blur",function(){setTimeout(function(){u.style.display="none",d.style.display="none",i.value=""},200)}),i.addEventListener("input",function(){let e;return function(){clearTimeout(e),e=setTimeout(function(){(async()=>{try{s.innerHTML="";let e=i.value;if(""!==e){u.style.display="none",d.style.display="block";const t=(await a(n("https://n44t2at2rv.re.qweatherapi.com/geo/v2/city/lookup?location=北&range=cn&key=0f78c7eacd1d4118822553781c889ca8",e))).data.location||[];l=[];for(let e=0;e<t.length;e++){const a=[t[e].adm1,t[e].adm2,t[e].name].filter(Boolean).filter((e,t,a)=>a.indexOf(e)===t).join(",");l.push({name:a,code:t[e].id,location:t[e].adm1+" "+t[e].name})}0!==l.length?(l=l.map(function(t){const a=t.location.replace(new RegExp(`(${e})`,"gi"),'<span class="highlight">$1</span>');return`<li data-code="${t.code}"  data-location="${t.location}">${a}</li>`}),s.innerHTML=l.join("")):s.innerHTML='<li style="text-align: center; color: #888;">抱歉，未找到相关位置</li>'}else console.log("没有"),u.style.display="block",d.style.display="none"}catch(e){console.log(e)}})()},500)}}());const m={code:c.code};localStorage.setItem("code",JSON.stringify(m));const y=new Proxy(m,{set:(e,t,a)=>(e[t]=a,localStorage.setItem("code",JSON.stringify(m)),q(),f(),!0)});document.querySelector(".search_list ul").addEventListener("click",function(e){"LI"===e.target.tagName&&(i.value="",e.target.dataset.code&&(S.innerHTML=e.target.dataset.location,y.code=e.target.dataset.code,b({name:e.target.dataset.location.slice(S.innerHTML.lastIndexOf(" ")+1),code:e.target.dataset.code}),console.log(y.code)))});const g=JSON.parse(localStorage.getItem("arrConcern"))?JSON.parse(localStorage.getItem("arrConcern")):[];u.addEventListener("click",function(e){if(void 0!==e.target.parentNode.dataset.code){let t=e.target.parentNode;console.log(`转到${t.dataset.code}`),y.code=Number(t.dataset.code),document.querySelector(".nav_p").innerHTML=t.dataset.name,b({name:t.dataset.name,code:t.dataset.code})}});const p=new Proxy(g,{set:(e,t,a)=>("length"===t&&($(g),f()),Reflect.set(e,t,a)),deleteProperty(e,t){let a=Reflect.deleteProperty(...arguments);return f(),a}});function f(){const e=document.querySelector(".nav_a:last-of-type");for(let t=0;t<g.length;t++)if(g[t]&&Number(y.code)===Number(g[t].code))return void(e.innerHTML="[已关注]");e.innerHTML="[添加关注]",e.style.cursor="pointer"}const h=document.querySelector(".full_city"),w=document.querySelector(".nav_a:last-of-type"),S=document.querySelector(".nav_p");function $(e){console.log(e.length);const t=document.querySelector(".concern ul");let a="";0===e.length&&(a="<span>点击“添加关注”添加城市哟~</span>");for(let t=0;g[t]&&t<e.length;t++)Number(e[t].code)!==Number(c.code)||c.flag?a+=`<li data-code="${e[t].code}">\n           <p>\n           <span>${e[t].name}</span>\n           <a class="set_default">设为默认</a>\n           </p>\n            <img src="./data/img/small${e[t].data.icon}.png" alt="">\n            <p class="weather" data-icon="${e[t].data.icon}">${e[t].data.weatherName}</p>\n            <p class="temperature">${e[t].data.Min}°/${e[t].data.Max}°</p>\n            <a class="delete_concern"></a>\n            </li>`:a+=`<li data-code="${e[t].code}">\n           <p class="default_color">\n           <span>${e[t].name}</span>\n           <a class="set_default">取消默认</a>\n           </p>\n            <img src="./data/img/small${e[t].data.icon}.png" alt="">\n            <p class="weather">${e[t].data.weatherName}</p>\n            <p class="temperature">${e[t].data.Min}°/${e[t].data.Max}°</p>\n            <a class="delete_concern"></a>\n            </li>`;t.innerHTML=a}function b(e){const t=JSON.parse(localStorage.getItem("historydata"))||[];for(let a=0;a<t.length;a++)if(Number(e.code)===Number(t[a].code))return;t.unshift(e),t.length>4&&t.pop(),localStorage.setItem("historydata",JSON.stringify(t)),v(),document.querySelector(".history").style.display="block"}function v(){const e=document.querySelector(".history"),t=JSON.parse(localStorage.getItem("historydata"))||[];if(0===t.length)return void(e.style.display="none");let a="";for(let e=0;e<t.length;e++)a+=`<li data-code="${t[e].code}" data-name="${t[e].name}"><p>${t[e].name}</p></li>`;document.querySelector(".history ul").innerHTML=a}function q(){var o,r;$(g),f(),console.log(`请求${y.code}数据`),v(),a(n("https://n44t2at2rv.re.qweatherapi.com/v7/indices/1d?type=0&location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))).then(e=>{let t=e.data.daily;const a=[2,11,3,5,8,1,14,9,0,15,7,13];let n="";const o=document.querySelector(".daily_index .window ul");for(let e=0;e<a.length;e++)n+=`\n                            <li>\n                                <div class="daily_son">\n                                    <div class="top">\n                                        <img src="/data/img/dailyicon${a[e]}.png" alt="">\n                                        <p>${t[a[e]].name.slice(0,-2)}  ${t[a[e]].category}</p>\n                                    </div>\n                                    <div class="down">\n                                    ${t[a[e]].text}\n                                    </div>\n                                </div>\n                            </li>\n                            `;o.innerHTML=n}),function(e,t){let a=[];Promise.all([e,t]).then(([e,t])=>{localStorage.setItem("7ddata",JSON.stringify(e.data)),a=JSON.parse(JSON.stringify(e.data.daily));let n=12,o=0;for(let e of t.data.weatherHourly)n>Number(e.windScale)&&(n=Number(e.windScale)),o<Number(e.windScale)&&(o=Number(e.windScale));a.unshift({tempMax:t.data.weatherDaily.tempMax,tempMin:t.data.weatherDaily.tempMin,fxDate:t.data.weatherDaily.date,textDay:t.data.weatherHourly[11].text,iconDay:t.data.weatherHourly[11].icon,textNight:t.data.weatherHourly[23].text,iconNight:t.data.weatherHourly[23].icon,windScaleDay:`${n}-${o}`}),function(e){let t,a="";for(let t=0;t<e.length;t++){const n=(new Date).getDay(),o=["无风","软风","轻风","微风","和风","清风","强风","疾风","大风","烈风","狂风","暴风","台风级"],r=["周一","周二","周三","周四","周五","周六","周天"],c=["昨天","今天","明天","后天",r[(n+2)%7],r[(n+3)%7],r[(n+4)%7],r[(n+5)%7]],l=e[t].fxDate.slice(5).replace("-","月")+"日";a+=`\n        <li>\n                <p class="day">${c[t]}</p>\n                <p class="date">${l}</p>\n                <div class="day_weather">\n                    <p class="day_weathername">${e[t].textDay}</p>\n                    <img src="./data/img/small${e[t].iconDay}.png" alt="">\n                </div>\n                <div class="night_weather">\n                    <img src="./data/img/small${e[t].iconNight}.png" alt="">\n                    <p class="night_weathername">${e[t].textNight}</p>\n                </div>\n                <p class="seven_day_wind">${o[Number(e[t].windScaleDay.slice(-1))]}${e[t].windScaleDay}级</p>\n            </li>\n        `}switch(document.querySelector(".wind").innerHTML=`${e[1].windDirDay} ${e[1].windScaleDay}级`,e[1].windDirDay){case"北风":t=180;break;case"东北风":t=225;break;case"东风":t=270;break;case"东南风":t=315;break;case"南风":t=0;break;case"西南风":t=45;break;case"西风":t=90;break;case"西北风":t=135}document.querySelector(".wind_before").style.rotate=`${t}deg`,document.querySelector(".seven_day ul").innerHTML=a}(a),function(e){const t=document.getElementById("myChart");let a=[],n=[];for(let t=0;t<e.length;t++)a.push(e[t].tempMax),n.push(e[t].tempMin);const o={type:"line",data:{labels:[0,1,2,3,4,5,6,7],datasets:[{label:"",data:a,fill:!1,borderColor:"rgb(255, 208, 0)",pointBackgroundColor:"rgb(255, 208, 0)",tension:.3,datalabels:{display:!0,align:"top",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}},{label:"",data:n,fill:!1,borderColor:"rgb(105, 175, 255)",pointBackgroundColor:"rgb(105, 175, 255)",tension:.3,datalabels:{display:!0,align:"bottom",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}}]},options:{plugins:{legend:{display:!1},tooltip:{enabled:!1}},layout:{padding:{top:60,right:60,bottom:60,left:60}},scales:{x:{display:!1},y:{display:!1}},animation:!1,responsive:!0,maintainAspectRatio:!1}};Chart.getChart(t)&&Chart.getChart(t).destroy(),new Chart(t,o)}(a),document.querySelector(".weather15d").href=`https://www.weather.com.cn/weather15d/${JSON.parse(localStorage.getItem("code")).code}.shtml`})}(a(n(e,String(y.code))),a(n(t,String(y.code)))),o=a(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/24h?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))),r=a(n(e,String(y.code))),Promise.all([o,r]).then(([e,t])=>{console.log(e.data),console.log(t.data);let a=[{fxTime:t.data.daily[0].fxDate+"T"+t.data.daily[0].sunrise+"+08:00",icon:"sunrise",temp:"日出"},{fxTime:t.data.daily[0].fxDate+"T"+t.data.daily[0].sunset+"+08:00",icon:"sunset",temp:"日落"},{fxTime:t.data.daily[1].fxDate+"T"+t.data.daily[1].sunrise+"+08:00",icon:"sunrise",temp:"日出"},{fxTime:t.data.daily[1].fxDate+"T"+t.data.daily[1].sunset+"+08:00",icon:"sunset",temp:"日落"}];a=a.filter(t=>new Date(t.fxTime)>=new Date(e.data.hourly[0].fxTime)&&new Date(t.fxTime)<=new Date(e.data.hourly[23].fxTime));let n=function(e,t){const a=[];let n=0,o=0;for(;n<e.length&&o<t.length;)new Date(e[n].fxTime)<=new Date(t[o].fxTime)?a.push(e[n++]):a.push(t[o++]);return a.concat(e.slice(n)).concat(t.slice(o))}(e.data.hourly,a),o="";for(let e of n){let t;t="sunset"!==e.icon&&"sunrise"!==e.icon?e.temp+"°":e.temp,o+=`\n                        <li>\n                            <p class="text_time">${e.fxTime.slice(11,16)}</p>\n                            <img src="/data/img/small${e.icon}.png" alt="">\n                            <p class="text_deg">${t}</p>\n                            </li>\n                        `}document.querySelector(".see ul").innerHTML=o}),a(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/now?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))).then(e=>{document.querySelector(".push_time").innerHTML=`中央气象台${e.data.now.obsTime.slice(11,16)}发布`,document.querySelector(".now_temp").innerHTML=`${e.data.now.temp}°`,document.querySelector(".weather_name").innerHTML=`${e.data.now.text}`,document.querySelector(".now_icon").style.background=`url(/data/img/big${e.data.now.icon}.png)`,document.querySelector(".humidity").innerHTML=`湿度 ${e.data.now.humidity}%`,document.querySelector(".kPa").innerHTML=`气压 ${e.data.now.pressure}hPa`}),function(e){e.then(e=>{let t=e.data.warning;console.log(t);let a="";for(let e of t){let t;switch(e.level){case"蓝色":default:t="#86c5f7";break;case"黄色":t="#f5d271";break;case"橙色":t="#ef8c6b";break;case"红色":t="#ec807c"}a+=`<li style="background-color: ${t};">\n            ${e.typeName.slice(-2)}预警\n                            <div class="cotain">\n                                <div class="title" style="background-color: ${t};">${e.typeName}${e.level}预警</div>\n                                <p>${e.text}\n                                </p>\n                            </div>\n                        </li>\n                        `}document.querySelector(".warning").innerHTML=a})}(a(n("https://n44t2at2rv.re.qweatherapi.com/v7/warning/now?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code)))),function(e){e.then(e=>{let t,a;switch(console.log(e.data),e.data.now.category){case"优":t="#a3d765",a="../data/img/you.png";break;case"良":default:t="#f0cc35",a="../data/img/liang.png";break;case"轻度污染":t="#f1ab62",a="../data/img/qingduwuran.png";break;case"中度污染":case"重度污染":case"严重污染":t="#ad788a",a="../data/img/yanzhongwuran.png"}const n=document.createElement("style");n.textContent=`\n        .now_aqi {\n         background-color: ${t};\n        }\n        .airtitle{\n        background-color: ${t};\n        }\n        .ct_main .now_aqi::before{\n                background-image: url(${a});\n                background-color: #fff;\n                \n        }\n        `,document.querySelector(".now_aqi span").innerHTML=`${e.data.now.aqi} ${e.data.now.category}`,document.querySelector(".airtitle").innerHTML=`空气质量指数 ${e.data.now.aqi} ${e.data.now.category}`,document.querySelector(".pm25").innerHTML=`${e.data.now.pm2p5}`,document.querySelector(".pm10").innerHTML=`${e.data.now.pm10}`,document.querySelector(".so2").innerHTML=`${e.data.now.so2}`,document.querySelector(".no2").innerHTML=`${e.data.now.no2}`,document.querySelector(".o3").innerHTML=`${e.data.now.o3}`,document.querySelector(".co").innerHTML=`${e.data.now.co}`,document.head.appendChild(n)})}(a(n("https://n44t2at2rv.re.qweatherapi.com/v7/air/now?location=101010100&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))))}w.addEventListener("mouseleave",function(){h.style.display="none"}),w.addEventListener("click",function(e){if(e.preventDefault(),"[添加关注]"===w.innerHTML){let e=JSON.parse(localStorage.getItem("7ddata")).daily[0];5!==p.length?(p.push({name:S.innerHTML.slice(S.innerHTML.lastIndexOf(" ")+1),code:y.code,data:{weatherName:e.textDay,Max:e.tempMax,Min:e.tempMin,icon:e.iconDay}}),w.innerHTML="[已关注]",w.style.cursor="default",localStorage.setItem("arrConcern",JSON.stringify(g))):h.style.display="inline-block"}}),document.querySelector(".concern ul").addEventListener("click",function(e){if("P"===e.target.tagName){let t=e.target.parentElement;y.code!==Number(t.dataset.code)&&(y.code=Number(t.dataset.code),S.innerHTML=e.target.parentElement.firstElementChild.firstElementChild.innerHTML)}if("set_default"===e.target.className){if("设为默认"===e.target.innerHTML){const t=e.target.parentElement.firstElementChild;c={name:t.innerHTML,code:Number(e.target.parentElement.parentElement.dataset.code)},localStorage.setItem("default_last",JSON.stringify(c))}else c={name:"陕西 西安",code:101110101,flag:!0},localStorage.setItem("default_last",JSON.stringify(c));$(g)}if("delete_concern"===e.target.className){let t=Number(e.target.parentElement.dataset.code);for(let e=0;e<p.length;e++)Number(p[e].code)===t&&(delete p[e],g.splice(e,1),localStorage.setItem("arrConcern",JSON.stringify(g)),$(g));e.target.parentElement.remove()}}),document.querySelector(".btn").addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(".history");localStorage.removeItem("historydata"),t.style.display="none"}),document.querySelector(".nav_p").innerHTML=c.name,q()})();