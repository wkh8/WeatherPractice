(()=>{"use strict";function e(e){return axios({url:e}).then(e=>e).catch(e=>{console.error(e)})}function t(e,t){if(e.startsWith("https")){let a=new URL(e);return a.searchParams.set("location",t),a.href}return e}requestAnimationFrame(()=>{setTimeout(()=>{document.querySelector(".see ul").classList.add("transition")},100)});let a=0;document.querySelector(".two_btn .right").addEventListener("click",function(){const e=document.querySelector(".see ul");a=a+1100>e.clientWidth-1200?e.clientWidth-1200:1100+a,e.style.transform=`translateX(-${a}px)`,console.log(a)}),document.querySelector(".two_btn .left").addEventListener("click",function(){const e=document.querySelector(".see ul");a-1100>0?a-=1100:a=0,e.style.transform=`translateX(-${a}px)`}),Chart.register(ChartDataLabels);const n=JSON.parse(localStorage.getItem("default_last"))||{name:"陕西,西安",code:101110101};console.log(n),"WeatherCity"in localStorage||axios({url:"../data/localData/city.json"}).then(e=>{const t=e.data;localStorage.setItem("WeatherCity",JSON.stringify(t))});const o=JSON.parse(localStorage.getItem("WeatherCity"));let r;const l=document.querySelector(".search_city"),c=document.querySelector(".search_list"),i=document.querySelector(".search_list ul"),s=document.querySelector(".hot_city");l.addEventListener("focus",function(){s.style.display="block"}),l.addEventListener("blur",function(){setTimeout(function(){s.style.display="none",c.style.display="none",l.value=""},200)}),l.addEventListener("input",function(){let e;return function(){clearTimeout(e),e=setTimeout(function(){!function(){i.innerHTML="";let e=l.value;""!==e?(s.style.display="none",c.style.display="block",r=o.filter(function(t,a){return t.name.includes(e)}),0!==r.length?(r=r.map(function(t){const a=t.name.replace(new RegExp(`(${e})`,"gi"),'<span class="highlight">$1</span>');return`<li data-code="${t.code}">${a}</li>`}),i.innerHTML=r.join("")):i.innerHTML='<li style="text-align: center; color: #888;">抱歉，未找到相关位置</li>'):(console.log("没有"),s.style.display="block",c.style.display="none")}()},300)}}());const d={code:n.code};localStorage.setItem("code",JSON.stringify(d));const u=new Proxy(d,{set:(e,t,a)=>(e[t]=a,localStorage.setItem("code",JSON.stringify(d)),N(),g(),!0)});document.querySelector(".search_list ul").addEventListener("click",function(e){if("LI"===e.target.tagName&&(l.value="",e.target.dataset.code)){const t=document.querySelector(".nav_p");t.innerHTML=e.target.innerHTML.match(/[\u4e00-\u9fa5,]/g)?.join(""),u.code=e.target.dataset.code,w({name:t.innerHTML.match(/[\u4e00-\u9fa5,]/g)?.join("").slice(f.innerHTML.lastIndexOf(",")+1),code:e.target.dataset.code}),console.log(u.code)}});const m=JSON.parse(localStorage.getItem("arrConcern"))?JSON.parse(localStorage.getItem("arrConcern")):[];s.addEventListener("click",function(e){if(void 0!==e.target.parentNode.dataset.code){let t=e.target.parentNode;console.log(`转到${t.dataset.code}`),u.code=Number(t.dataset.code),document.querySelector(".nav_p").innerHTML=t.dataset.name,w({name:t.dataset.name,code:t.dataset.code})}});const y=new Proxy(m,{set:(e,t,a)=>("length"===t&&(S(m),g()),Reflect.set(e,t,a)),deleteProperty(e,t){let a=Reflect.deleteProperty(...arguments);return g(),a}});function g(){const e=document.querySelector(".nav_a:last-of-type");for(let t=0;t<m.length;t++)if(m[t]&&u.code===Number(m[t].code))return void(e.innerHTML="[已关注]");e.innerHTML="[添加关注]",e.style.cursor="pointer"}const p=document.querySelector(".full_city"),h=document.querySelector(".nav_a:last-of-type"),f=document.querySelector(".nav_p");function S(e){const t=document.querySelector(".concern ul");let a="";for(let t=0;m[t]&&t<e.length;t++)a+=`<li data-code="${e[t].code}">\n           <p>\n           <span>${e[t].name}</span>\n           <a class="set_default">设为默认</a>\n           </p>\n            <p class="weather" data-icon="${e[t].data.icon}">${e[t].data.weatherName}</p>\n            <p class="temperature">${e[t].data.Min}°/${e[t].data.Max}°</p>\n            <a class="delete_concern"></a>\n            </li>`;t.innerHTML=a}function w(e){const t=JSON.parse(localStorage.getItem("historydata"))||[];for(let a=0;a<t.length;a++)if(Number(e.code)===Number(t[a].code))return;t.unshift(e),t.length>4&&t.pop(),localStorage.setItem("historydata",JSON.stringify(t)),b(),document.querySelector(".history").style.display="block"}function b(){const e=document.querySelector(".history"),t=JSON.parse(localStorage.getItem("historydata"))||[];if(0===t.length)return void(e.style.display="none");let a="";for(let e=0;e<t.length;e++)a+=`<li data-code="${t[e].code}" data-name="${t[e].name}"><p>${t[e].name}</p></li>`;document.querySelector(".history ul").innerHTML=a}function N(){S(m),g(),console.log(`请求${u.code}数据`),b(),e(t("../data/localData/1d.json",String(u.code))).then(e=>{e.data}),function(e,t){let a=[];e.then(e=>{a=JSON.parse(JSON.stringify(e.data.daily))}),t.then(e=>{let t=12,n=0;for(let a of e.data.weatherHourly)t>Number(a.windScale)&&(t=Number(a.windScale)),n<Number(a.windScale)&&(n=Number(a.windScale));a.unshift({tempMax:e.data.weatherDaily.tempMax,tempMin:e.data.weatherDaily.tempMin,fxDate:e.data.weatherDaily.date,textDay:e.data.weatherHourly[11].text,iconDay:e.data.weatherHourly[11].icon,textNight:e.data.weatherHourly[23].text,iconNight:e.data.weatherHourly[23].icon,windScaleDay:`${t}-${n}`}),console.log(a),function(e){let t,a="";for(let t=0;t<e.length;t++){const n=(new Date).getDay(),o=["无风","软风","轻风","微风","和风","清风","强风","疾风","大风","烈风","狂风","暴风","台风级"],r=["周一","周二","周三","周四","周五","周六","周天"],l=["昨天","今天","明天","后天",r[(n+2)%7],r[(n+3)%7],r[(n+4)%7],r[(n+5)%7]],c=e[t].fxDate.slice(5).replace("-","月")+"日";a+=`\n        <li>\n                <p class="day">${l[t]}</p>\n                <p class="date">${c}</p>\n                <div class="day_weather">\n                    <p class="day_weathername">${e[t].textDay}</p>\n                    <img src="./data/img/small${e[t].iconDay}.png" alt="">\n                </div>\n                <div class="night_weather">\n                    <img src="./data/img/small${e[t].iconNight}.png" alt="">\n                    <p class="night_weathername">${e[t].textNight}</p>\n                </div>\n                <p class="seven_day_wind">${o[Number(e[t].windScaleDay.slice(-1))]}${e[t].windScaleDay}级</p>\n            </li>\n        `}switch(document.querySelector(".wind").innerHTML=`${e[1].windDirDay} ${e[1].windScaleDay}级`,e[1].windDirDay){case"北风":t=180;break;case"东北风":t=225;break;case"东风":t=270;break;case"东南风":t=315;break;case"南风":t=0;break;case"西南风":t=45;break;case"西风":t=90;break;case"西北风":t=135}document.querySelector(".wind_before").style.rotate=`${t}deg`,document.querySelector(".seven_day ul").innerHTML=a}(a),function(e){const t=document.getElementById("myChart");let a=[],n=[];for(let t=0;t<e.length;t++)a.push(e[t].tempMax),n.push(e[t].tempMin);const o={type:"line",data:{labels:[0,1,2,3,4,5,6,7],datasets:[{label:"",data:a,fill:!1,borderColor:"rgb(255, 208, 0)",pointBackgroundColor:"rgb(255, 208, 0)",tension:.3,datalabels:{display:!0,align:"top",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}},{label:"",data:n,fill:!1,borderColor:"rgb(105, 175, 255)",pointBackgroundColor:"rgb(105, 175, 255)",tension:.3,datalabels:{display:!0,align:"bottom",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}}]},options:{plugins:{legend:{display:!1},tooltip:{enabled:!1}},layout:{padding:{top:60,right:60,bottom:60,left:60}},scales:{x:{display:!1},y:{display:!1}},animation:!1,responsive:!0,maintainAspectRatio:!1}};Chart.getChart(t)&&Chart.getChart(t).destroy(),new Chart(t,o)}(a),document.querySelector(".weather15d").href=`https://www.weather.com.cn/weather15d/${JSON.parse(localStorage.getItem("code")).code}.shtml`})}(e(t("../data/localData/7d.json",String(u.code))),e(t("../data/localData/yesterday.json",String(u.code)))),function(e){let t="";e.then(e=>{for(let a of e.data.hourly){let e=a.fxTime.slice(11,16),n=a.icon,o=a.temp;t+=`\n            <li>\n                <p class="text_time">${e}</p>\n                <img src="/data/img/small${n}.png" alt="">\n                <p class="text_deg">${o}°</p>\n            </li>\n            `}document.querySelector(".see ul").innerHTML=t})}(e(t("../data/localData/24h.json",String(u.code)))),e(t("../data/localData/now.json",String(u.code))).then(e=>{e.data,document.querySelector(".now_temp").innerHTML=`${e.data.now.temp}°`,document.querySelector(".weather_name").innerHTML=`${e.data.now.text}`,document.querySelector(".now_icon").style.background=`url(/data/img/big${e.data.now.icon}.png)`,document.querySelector(".humidity").innerHTML=`湿度 ${e.data.now.humidity}%`,document.querySelector(".kPa").innerHTML=`气压 ${e.data.now.pressure}hPa`})}h.addEventListener("mouseleave",function(){p.style.display="none"}),h.addEventListener("click",function(e){if(e.preventDefault(),"[添加关注]"===h.innerHTML){let e=JSON.parse(localStorage.getItem("7ddata")).daily[0];5!==y.length?(y.push({name:f.innerHTML.slice(f.innerHTML.lastIndexOf(",")+1),code:u.code,data:{weatherName:e.textDay,Max:e.tempMax,Min:e.tempMin,icon:e.iconDay}}),h.innerHTML="[已关注]",h.style.cursor="default",localStorage.setItem("arrConcern",JSON.stringify(m))):p.style.display="inline-block"}}),document.querySelector(".concern ul").addEventListener("click",function(e){if("P"===e.target.tagName){let t=e.target.parentElement;u.code!==Number(t.dataset.code)&&(u.code=Number(t.dataset.code),document.querySelector("nav_p"),f.innerHTML=e.target.parentElement.firstElementChild.firstElementChild.innerHTML)}if("set_default"===e.target.className){const t=e.target.parentElement.firstElementChild;localStorage.setItem("default_last",JSON.stringify({name:t.innerHTML,code:Number(e.target.parentElement.parentElement.dataset.code)}))}if("delete_concern"===e.target.className){let t=Number(e.target.parentElement.dataset.code);for(let e=0;e<y.length;e++)Number(y[e].code)===t&&(delete y[e],m.splice(e,1),localStorage.setItem("arrConcern",JSON.stringify(m)));e.target.parentElement.remove()}}),document.querySelector(".btn").addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(".history");localStorage.removeItem("historydata"),t.style.display="none"}),document.querySelector(".nav_p").innerHTML=n.name,N()})();