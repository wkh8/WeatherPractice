(()=>{"use strict";const e=`https://n44t2at2rv.re.qweatherapi.com/v7/historical/weather?location=101010100&date=${function(){const e=new Date;return e.setDate(e.getDate()-1),[e.getFullYear(),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("")}()}&key=0f78c7eacd1d4118822553781c889ca8`;function t(e){return axios({url:e}).then(e=>e).catch(e=>{console.error(e)})}function n(e,t){if(e.startsWith("https")){let n=new URL(e);return n.searchParams.set("location",t),n.href}return e}requestAnimationFrame(()=>{setTimeout(()=>{document.querySelector(".see ul").classList.add("transition")},100)});let a=0;document.querySelector(".two_btn .right").addEventListener("click",function(){const e=document.querySelector(".see ul");a=a+1100>e.clientWidth-1200?e.clientWidth-1200:1100+a,e.style.transform=`translateX(-${a}px)`,console.log(a)}),document.querySelector(".two_btn .left").addEventListener("click",function(){const e=document.querySelector(".see ul");a-1100>0?a-=1100:a=0,e.style.transform=`translateX(-${a}px)`}),Chart.register(ChartDataLabels);let r=0;document.querySelector(".daily_left").addEventListener("click",function(){0!==r&&(r=0,document.querySelector(".daily_index ul").style.transform=`translateX(-${r}px)`)}),document.querySelector(".daily_right").addEventListener("click",function(){0===r&&(r=458,console.log(111),document.querySelector(".daily_index ul").style.transform=`translateX(-${r}px)`)});const o=JSON.parse(localStorage.getItem("default_last"))||{name:"陕西,西安",code:101110101};"WeatherCity"in localStorage||axios({url:"../data/localData/city.json"}).then(e=>{const t=e.data;localStorage.setItem("WeatherCity",JSON.stringify(t))});const l=JSON.parse(localStorage.getItem("WeatherCity"));let c;const i=document.querySelector(".search_city"),d=document.querySelector(".search_list"),s=document.querySelector(".search_list ul"),u=document.querySelector(".hot_city");i.addEventListener("focus",function(){u.style.display="block"}),i.addEventListener("blur",function(){setTimeout(function(){u.style.display="none",d.style.display="none",i.value=""},200)}),i.addEventListener("input",function(){let e;return function(){clearTimeout(e),e=setTimeout(function(){!function(){s.innerHTML="";let e=i.value;""!==e?(u.style.display="none",d.style.display="block",c=l.filter(function(t,n){return t.name.includes(e)}),0!==c.length?(c=c.map(function(t){const n=t.name.replace(new RegExp(`(${e})`,"gi"),'<span class="highlight">$1</span>');return`<li data-code="${t.code}">${n}</li>`}),s.innerHTML=c.join("")):s.innerHTML='<li style="text-align: center; color: #888;">抱歉，未找到相关位置</li>'):(console.log("没有"),u.style.display="block",d.style.display="none")}()},300)}}());const m={code:o.code};localStorage.setItem("code",JSON.stringify(m));const y=new Proxy(m,{set:(e,t,n)=>(e[t]=n,localStorage.setItem("code",JSON.stringify(m)),q(),h(),!0)});document.querySelector(".search_list ul").addEventListener("click",function(e){if("LI"===e.target.tagName&&(i.value="",e.target.dataset.code)){const t=document.querySelector(".nav_p");t.innerHTML=e.target.innerHTML.match(/[\u4e00-\u9fa5,]/g)?.join(""),y.code=e.target.dataset.code,b({name:t.innerHTML.match(/[\u4e00-\u9fa5,]/g)?.join("").slice(w.innerHTML.lastIndexOf(",")+1),code:e.target.dataset.code}),console.log(y.code)}});const g=JSON.parse(localStorage.getItem("arrConcern"))?JSON.parse(localStorage.getItem("arrConcern")):[];u.addEventListener("click",function(e){if(void 0!==e.target.parentNode.dataset.code){let t=e.target.parentNode;console.log(`转到${t.dataset.code}`),y.code=Number(t.dataset.code),document.querySelector(".nav_p").innerHTML=t.dataset.name,b({name:t.dataset.name,code:t.dataset.code})}});const p=new Proxy(g,{set:(e,t,n)=>("length"===t&&(v(g),h()),Reflect.set(e,t,n)),deleteProperty(e,t){let n=Reflect.deleteProperty(...arguments);return h(),n}});function h(){const e=document.querySelector(".nav_a:last-of-type");for(let t=0;t<g.length;t++)if(g[t]&&y.code===Number(g[t].code))return void(e.innerHTML="[已关注]");e.innerHTML="[添加关注]",e.style.cursor="pointer"}const f=document.querySelector(".full_city"),S=document.querySelector(".nav_a:last-of-type"),w=document.querySelector(".nav_p");function v(e){const t=document.querySelector(".concern ul");let n="";for(let t=0;g[t]&&t<e.length;t++)n+=`<li data-code="${e[t].code}">\n           <p>\n           <span>${e[t].name}</span>\n           <a class="set_default">设为默认</a>\n           </p>\n            <p class="weather" data-icon="${e[t].data.icon}">${e[t].data.weatherName}</p>\n            <p class="temperature">${e[t].data.Min}°/${e[t].data.Max}°</p>\n            <a class="delete_concern"></a>\n            </li>`;t.innerHTML=n}function b(e){const t=JSON.parse(localStorage.getItem("historydata"))||[];for(let n=0;n<t.length;n++)if(Number(e.code)===Number(t[n].code))return;t.unshift(e),t.length>4&&t.pop(),localStorage.setItem("historydata",JSON.stringify(t)),$(),document.querySelector(".history").style.display="block"}function $(){const e=document.querySelector(".history"),t=JSON.parse(localStorage.getItem("historydata"))||[];if(0===t.length)return void(e.style.display="none");let n="";for(let e=0;e<t.length;e++)n+=`<li data-code="${t[e].code}" data-name="${t[e].name}"><p>${t[e].name}</p></li>`;document.querySelector(".history ul").innerHTML=n}function q(){v(g),h(),console.log(`请求${y.code}数据`),$(),t(n("https://n44t2at2rv.re.qweatherapi.com/v7/indices/1d?type=0&location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))).then(e=>{let t=e.data.daily;const n=[2,11,3,5,8,1,14,9,0,15,7,13];console.log(n),console.log(t);let a="";const r=document.querySelector(".daily_index .window ul");for(let e=0;e<n.length;e++)a+=`\n                            <li>\n                                <div class="daily_son">\n                                    <div class="top">\n                                        <img src="/data/img/dailyicon${n[e]}.png" alt="">\n                                        <p>${t[n[e]].name.slice(0,-2)}  ${t[n[e]].category}</p>\n                                    </div>\n                                    <div class="down">\n                                    ${t[n[e]].text}\n                                    </div>\n                                </div>\n                            </li>\n                            `;r.innerHTML=a}),function(e,t){let n=[];e.then(e=>{n=JSON.parse(JSON.stringify(e.data.daily))}),t.then(e=>{let t=12,a=0;for(let n of e.data.weatherHourly)t>Number(n.windScale)&&(t=Number(n.windScale)),a<Number(n.windScale)&&(a=Number(n.windScale));n.unshift({tempMax:e.data.weatherDaily.tempMax,tempMin:e.data.weatherDaily.tempMin,fxDate:e.data.weatherDaily.date,textDay:e.data.weatherHourly[11].text,iconDay:e.data.weatherHourly[11].icon,textNight:e.data.weatherHourly[23].text,iconNight:e.data.weatherHourly[23].icon,windScaleDay:`${t}-${a}`}),function(e){let t,n="";for(let t=0;t<e.length;t++){const a=(new Date).getDay(),r=["无风","软风","轻风","微风","和风","清风","强风","疾风","大风","烈风","狂风","暴风","台风级"],o=["周一","周二","周三","周四","周五","周六","周天"],l=["昨天","今天","明天","后天",o[(a+2)%7],o[(a+3)%7],o[(a+4)%7],o[(a+5)%7]],c=e[t].fxDate.slice(5).replace("-","月")+"日";n+=`\n        <li>\n                <p class="day">${l[t]}</p>\n                <p class="date">${c}</p>\n                <div class="day_weather">\n                    <p class="day_weathername">${e[t].textDay}</p>\n                    <img src="./data/img/small${e[t].iconDay}.png" alt="">\n                </div>\n                <div class="night_weather">\n                    <img src="./data/img/small${e[t].iconNight}.png" alt="">\n                    <p class="night_weathername">${e[t].textNight}</p>\n                </div>\n                <p class="seven_day_wind">${r[Number(e[t].windScaleDay.slice(-1))]}${e[t].windScaleDay}级</p>\n            </li>\n        `}switch(document.querySelector(".wind").innerHTML=`${e[1].windDirDay} ${e[1].windScaleDay}级`,e[1].windDirDay){case"北风":t=180;break;case"东北风":t=225;break;case"东风":t=270;break;case"东南风":t=315;break;case"南风":t=0;break;case"西南风":t=45;break;case"西风":t=90;break;case"西北风":t=135}document.querySelector(".wind_before").style.rotate=`${t}deg`,document.querySelector(".seven_day ul").innerHTML=n}(n),function(e){const t=document.getElementById("myChart");let n=[],a=[];for(let t=0;t<e.length;t++)n.push(e[t].tempMax),a.push(e[t].tempMin);const r={type:"line",data:{labels:[0,1,2,3,4,5,6,7],datasets:[{label:"",data:n,fill:!1,borderColor:"rgb(255, 208, 0)",pointBackgroundColor:"rgb(255, 208, 0)",tension:.3,datalabels:{display:!0,align:"top",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}},{label:"",data:a,fill:!1,borderColor:"rgb(105, 175, 255)",pointBackgroundColor:"rgb(105, 175, 255)",tension:.3,datalabels:{display:!0,align:"bottom",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}}]},options:{plugins:{legend:{display:!1},tooltip:{enabled:!1}},layout:{padding:{top:60,right:60,bottom:60,left:60}},scales:{x:{display:!1},y:{display:!1}},animation:!1,responsive:!0,maintainAspectRatio:!1}};Chart.getChart(t)&&Chart.getChart(t).destroy(),new Chart(t,r)}(n),document.querySelector(".weather15d").href=`https://www.weather.com.cn/weather15d/${JSON.parse(localStorage.getItem("code")).code}.shtml`})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/7d?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))),t(n(e,String(y.code)))),function(e){let t="";e.then(e=>{for(let n of e.data.hourly){let e=n.fxTime.slice(11,16),a=n.icon,r=n.temp;t+=`\n            <li>\n                <p class="text_time">${e}</p>\n                <img src="/data/img/small${a}.png" alt="">\n                <p class="text_deg">${r}°</p>\n            </li>\n            `}document.querySelector(".see ul").innerHTML=t})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/24h?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code)))),t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/now?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(y.code))).then(e=>{e.data,document.querySelector(".now_temp").innerHTML=`${e.data.now.temp}°`,document.querySelector(".weather_name").innerHTML=`${e.data.now.text}`,document.querySelector(".now_icon").style.background=`url(/data/img/big${e.data.now.icon}.png)`,document.querySelector(".humidity").innerHTML=`湿度 ${e.data.now.humidity}%`,document.querySelector(".kPa").innerHTML=`气压 ${e.data.now.pressure}hPa`})}S.addEventListener("mouseleave",function(){f.style.display="none"}),S.addEventListener("click",function(e){if(e.preventDefault(),"[添加关注]"===S.innerHTML){let e=JSON.parse(localStorage.getItem("7ddata")).daily[0];5!==p.length?(p.push({name:w.innerHTML.slice(w.innerHTML.lastIndexOf(",")+1),code:y.code,data:{weatherName:e.textDay,Max:e.tempMax,Min:e.tempMin,icon:e.iconDay}}),S.innerHTML="[已关注]",S.style.cursor="default",localStorage.setItem("arrConcern",JSON.stringify(g))):f.style.display="inline-block"}}),document.querySelector(".concern ul").addEventListener("click",function(e){if("P"===e.target.tagName){let t=e.target.parentElement;y.code!==Number(t.dataset.code)&&(y.code=Number(t.dataset.code),document.querySelector("nav_p"),w.innerHTML=e.target.parentElement.firstElementChild.firstElementChild.innerHTML)}if("set_default"===e.target.className){const t=e.target.parentElement.firstElementChild;localStorage.setItem("default_last",JSON.stringify({name:t.innerHTML,code:Number(e.target.parentElement.parentElement.dataset.code)}))}if("delete_concern"===e.target.className){let t=Number(e.target.parentElement.dataset.code);for(let e=0;e<p.length;e++)Number(p[e].code)===t&&(delete p[e],g.splice(e,1),localStorage.setItem("arrConcern",JSON.stringify(g)));e.target.parentElement.remove()}}),document.querySelector(".btn").addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(".history");localStorage.removeItem("historydata"),t.style.display="none"}),document.querySelector(".nav_p").innerHTML=o.name,q()})();