(()=>{"use strict";const e=`https://n44t2at2rv.re.qweatherapi.com/v7/historical/weather?location=101010100&date=${function(){const e=new Date;return e.setDate(e.getDate()-1),[e.getFullYear(),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("")}()}&key=0f78c7eacd1d4118822553781c889ca8`;function t(e){return axios({url:e}).then(e=>e).catch(e=>{console.error(e)})}function n(e,t){if(e.startsWith("https")){let n=new URL(e);return n.searchParams.set("location",t),n.href}return e}requestAnimationFrame(()=>{setTimeout(()=>{document.querySelector(".see ul").classList.add("transition")},100)});let a=0;document.querySelector(".two_btn .right").addEventListener("click",function(){const e=document.querySelector(".see ul");a=a+1100>e.clientWidth-1200?e.clientWidth-1200:1100+a,e.style.transform=`translateX(-${a}px)`,console.log(a)}),document.querySelector(".two_btn .left").addEventListener("click",function(){const e=document.querySelector(".see ul");a-1100>0?a-=1100:a=0,e.style.transform=`translateX(-${a}px)`}),Chart.register(ChartDataLabels);let o=0;document.querySelector(".daily_left").addEventListener("click",function(){0!==o&&(o=0,document.querySelector(".daily_index ul").style.transform=`translateX(-${o}px)`)}),document.querySelector(".daily_right").addEventListener("click",function(){0===o&&(o=458,console.log(111),document.querySelector(".daily_index ul").style.transform=`translateX(-${o}px)`)});const r=JSON.parse(localStorage.getItem("default_last"))||{name:"陕西,西安",code:101110101};let c=[];const l=document.querySelector(".search_city"),i=document.querySelector(".search_list"),d=document.querySelector(".search_list ul"),s=document.querySelector(".hot_city");l.addEventListener("focus",function(){s.style.display="block"}),l.addEventListener("blur",function(){setTimeout(function(){s.style.display="none",i.style.display="none",l.value=""},200)}),l.addEventListener("input",function(){let e;return function(){clearTimeout(e),e=setTimeout(function(){(async()=>{try{d.innerHTML="";let e=l.value;if(""!==e){s.style.display="none",i.style.display="block";const a=(await t(n("../data/localData/mohucitye.json",e))).data.location||[];c=[];for(let e=0;e<a.length;e++){const t=[a[e].adm1,a[e].adm2,a[e].name].filter(Boolean).filter((e,t,n)=>n.indexOf(e)===t).join(",");c.push({name:t,code:a[e].id,location:a[e].adm1+" "+a[e].name})}0!==c.length?(c=c.map(function(t){const n=t.name.replace(new RegExp(`(${e})`,"gi"),'<span class="highlight">$1</span>');return`<li data-code="${t.code}"  data-location="${t.location}">${n}</li>`}),d.innerHTML=c.join("")):d.innerHTML='<li style="text-align: center; color: #888;">抱歉，未找到相关位置</li>'}else console.log("没有"),s.style.display="block",i.style.display="none"}catch(e){console.log(e)}})()},500)}}());const u={code:r.code};localStorage.setItem("code",JSON.stringify(u));const m=new Proxy(u,{set:(e,t,n)=>(e[t]=n,localStorage.setItem("code",JSON.stringify(u)),v(),p(),!0)});document.querySelector(".search_list ul").addEventListener("click",function(e){"LI"===e.target.tagName&&(l.value="",e.target.dataset.code&&(S.innerHTML=e.target.dataset.location,m.code=e.target.dataset.code,$({name:S.innerHTML.slice(S.innerHTML.lastIndexOf(" ")+1),code:e.target.dataset.code}),console.log(m.code)))});const y=JSON.parse(localStorage.getItem("arrConcern"))?JSON.parse(localStorage.getItem("arrConcern")):[];s.addEventListener("click",function(e){if(void 0!==e.target.parentNode.dataset.code){let t=e.target.parentNode;console.log(`转到${t.dataset.code}`),m.code=Number(t.dataset.code),document.querySelector(".nav_p").innerHTML=t.dataset.name,$({name:t.dataset.name,code:t.dataset.code})}});const g=new Proxy(y,{set:(e,t,n)=>("length"===t&&(w(y),p()),Reflect.set(e,t,n)),deleteProperty(e,t){let n=Reflect.deleteProperty(...arguments);return p(),n}});function p(){const e=document.querySelector(".nav_a:last-of-type");for(let t=0;t<y.length;t++)if(y[t]&&Number(m.code)===Number(y[t].code))return void(e.innerHTML="[已关注]");e.innerHTML="[添加关注]",e.style.cursor="pointer"}const h=document.querySelector(".full_city"),f=document.querySelector(".nav_a:last-of-type"),S=document.querySelector(".nav_p");function w(e){const t=document.querySelector(".concern ul");let n="";for(let t=0;y[t]&&t<e.length;t++)n+=`<li data-code="${e[t].code}">\n           <p>\n           <span>${e[t].name}</span>\n           <a class="set_default">设为默认</a>\n           </p>\n            <p class="weather" data-icon="${e[t].data.icon}">${e[t].data.weatherName}</p>\n            <p class="temperature">${e[t].data.Min}°/${e[t].data.Max}°</p>\n            <a class="delete_concern"></a>\n            </li>`;t.innerHTML=n}function $(e){const t=JSON.parse(localStorage.getItem("historydata"))||[];for(let n=0;n<t.length;n++)if(Number(e.code)===Number(t[n].code))return;t.unshift(e),t.length>4&&t.pop(),localStorage.setItem("historydata",JSON.stringify(t)),b(),document.querySelector(".history").style.display="block"}function b(){const e=document.querySelector(".history"),t=JSON.parse(localStorage.getItem("historydata"))||[];if(0===t.length)return void(e.style.display="none");let n="";for(let e=0;e<t.length;e++)n+=`<li data-code="${t[e].code}" data-name="${t[e].name}"><p>${t[e].name}</p></li>`;document.querySelector(".history ul").innerHTML=n}function v(){w(y),p(),console.log(`请求${m.code}数据`),b(),t(n("https://n44t2at2rv.re.qweatherapi.com/v7/indices/1d?type=0&location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(m.code))).then(e=>{let t=e.data.daily;const n=[2,11,3,5,8,1,14,9,0,15,7,13];console.log(n),console.log(t);let a="";const o=document.querySelector(".daily_index .window ul");for(let e=0;e<n.length;e++)a+=`\n                            <li>\n                                <div class="daily_son">\n                                    <div class="top">\n                                        <img src="/data/img/dailyicon${n[e]}.png" alt="">\n                                        <p>${t[n[e]].name.slice(0,-2)}  ${t[n[e]].category}</p>\n                                    </div>\n                                    <div class="down">\n                                    ${t[n[e]].text}\n                                    </div>\n                                </div>\n                            </li>\n                            `;o.innerHTML=a}),function(e,t){let n=[];e.then(e=>{n=JSON.parse(JSON.stringify(e.data.daily))}),t.then(e=>{let t=12,a=0;for(let n of e.data.weatherHourly)t>Number(n.windScale)&&(t=Number(n.windScale)),a<Number(n.windScale)&&(a=Number(n.windScale));n.unshift({tempMax:e.data.weatherDaily.tempMax,tempMin:e.data.weatherDaily.tempMin,fxDate:e.data.weatherDaily.date,textDay:e.data.weatherHourly[11].text,iconDay:e.data.weatherHourly[11].icon,textNight:e.data.weatherHourly[23].text,iconNight:e.data.weatherHourly[23].icon,windScaleDay:`${t}-${a}`}),function(e){let t,n="";for(let t=0;t<e.length;t++){const a=(new Date).getDay(),o=["无风","软风","轻风","微风","和风","清风","强风","疾风","大风","烈风","狂风","暴风","台风级"],r=["周一","周二","周三","周四","周五","周六","周天"],c=["昨天","今天","明天","后天",r[(a+2)%7],r[(a+3)%7],r[(a+4)%7],r[(a+5)%7]],l=e[t].fxDate.slice(5).replace("-","月")+"日";n+=`\n        <li>\n                <p class="day">${c[t]}</p>\n                <p class="date">${l}</p>\n                <div class="day_weather">\n                    <p class="day_weathername">${e[t].textDay}</p>\n                    <img src="./data/img/small${e[t].iconDay}.png" alt="">\n                </div>\n                <div class="night_weather">\n                    <img src="./data/img/small${e[t].iconNight}.png" alt="">\n                    <p class="night_weathername">${e[t].textNight}</p>\n                </div>\n                <p class="seven_day_wind">${o[Number(e[t].windScaleDay.slice(-1))]}${e[t].windScaleDay}级</p>\n            </li>\n        `}switch(document.querySelector(".wind").innerHTML=`${e[1].windDirDay} ${e[1].windScaleDay}级`,e[1].windDirDay){case"北风":t=180;break;case"东北风":t=225;break;case"东风":t=270;break;case"东南风":t=315;break;case"南风":t=0;break;case"西南风":t=45;break;case"西风":t=90;break;case"西北风":t=135}document.querySelector(".wind_before").style.rotate=`${t}deg`,document.querySelector(".seven_day ul").innerHTML=n}(n),function(e){const t=document.getElementById("myChart");let n=[],a=[];for(let t=0;t<e.length;t++)n.push(e[t].tempMax),a.push(e[t].tempMin);const o={type:"line",data:{labels:[0,1,2,3,4,5,6,7],datasets:[{label:"",data:n,fill:!1,borderColor:"rgb(255, 208, 0)",pointBackgroundColor:"rgb(255, 208, 0)",tension:.3,datalabels:{display:!0,align:"top",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}},{label:"",data:a,fill:!1,borderColor:"rgb(105, 175, 255)",pointBackgroundColor:"rgb(105, 175, 255)",tension:.3,datalabels:{display:!0,align:"bottom",anchor:"end",offset:4,color:e=>0===e.dataIndex?"silver":"rgba(37, 35, 35, 0.85)",font:{size:20},formatter:e=>`${e}°`}}]},options:{plugins:{legend:{display:!1},tooltip:{enabled:!1}},layout:{padding:{top:60,right:60,bottom:60,left:60}},scales:{x:{display:!1},y:{display:!1}},animation:!1,responsive:!0,maintainAspectRatio:!1}};Chart.getChart(t)&&Chart.getChart(t).destroy(),new Chart(t,o)}(n),document.querySelector(".weather15d").href=`https://www.weather.com.cn/weather15d/${JSON.parse(localStorage.getItem("code")).code}.shtml`})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/7d?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(m.code))),t(n(e,String(m.code)))),function(e){let t="";e.then(e=>{for(let n of e.data.hourly){let e=n.fxTime.slice(11,16),a=n.icon,o=n.temp;t+=`\n            <li>\n                <p class="text_time">${e}</p>\n                <img src="/data/img/small${a}.png" alt="">\n                <p class="text_deg">${o}°</p>\n            </li>\n            `}document.querySelector(".see ul").innerHTML=t})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/24h?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(m.code)))),t(n("https://n44t2at2rv.re.qweatherapi.com/v7/weather/now?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(m.code))).then(e=>{console.log(e.data),document.querySelector(".push_time").innerHTML=`中央气象台${e.data.now.obsTime.slice(11,16)}发布`,document.querySelector(".now_temp").innerHTML=`${e.data.now.temp}°`,document.querySelector(".weather_name").innerHTML=`${e.data.now.text}`,document.querySelector(".now_icon").style.background=`url(/data/img/big${e.data.now.icon}.png)`,document.querySelector(".humidity").innerHTML=`湿度 ${e.data.now.humidity}%`,document.querySelector(".kPa").innerHTML=`气压 ${e.data.now.pressure}hPa`}),function(e){e.then(e=>{let t=e.data.warning;console.log(t);let n="";for(let e of t){let t;switch(e.level){case"蓝色":default:t="#86c5f7";break;case"黄色":t="#f5d271";break;case"橙色":t="#ef8c6b";break;case"红色":t="#ec807c"}n+=`<li style="background-color: ${t};">\n            ${e.typeName}预警\n                            <div class="cotain">\n                                <div class="title" style="background-color: ${t};">${e.typeName}${e.level}预警</div>\n                                <p>${e.text}\n                                </p>\n                            </div>\n                        </li>\n                        `}document.querySelector(".warning").innerHTML=n})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/warning/now?location=101110101&key=0f78c7eacd1d4118822553781c889ca8",String(m.code)))),function(e){e.then(e=>{let t,n;switch(console.log(e.data),e.data.now.category){case"优":t="#a3d765",n="../data/img/you.png";break;case"良":default:t="#f0cc35",n="../data/img/liang.png";break;case"轻度污染":t="#f1ab62";break;case"中度污染":case"重度污染":break;case"严重污染":t="#ad788a",n="../data/img/yanzhongwuran.png"}const a=document.createElement("style");a.textContent=`\n        .now_aqi {\n         background-color: ${t};\n        }\n        .airtitle{\n        background-color: ${t};\n        }\n        .ct_main .now_aqi::before{\n                background-image: url(${n});\n                background-color: #fff;\n                \n        }\n        `,document.querySelector(".now_aqi span").innerHTML=`${e.data.now.aqi} ${e.data.now.category}`,document.querySelector(".airtitle").innerHTML=`空气质量指数 ${e.data.now.aqi} ${e.data.now.category}`,document.querySelector(".pm25").innerHTML=`${e.data.now.pm2p5}`,document.querySelector(".pm10").innerHTML=`${e.data.now.pm10}`,document.querySelector(".so2").innerHTML=`${e.data.now.so2}`,document.querySelector(".no2").innerHTML=`${e.data.now.no2}`,document.querySelector(".o3").innerHTML=`${e.data.now.o3}`,document.querySelector(".co").innerHTML=`${e.data.now.co}`,document.head.appendChild(a)})}(t(n("https://n44t2at2rv.re.qweatherapi.com/v7/air/now?location=101010100&key=0f78c7eacd1d4118822553781c889ca8",String(m.code))))}f.addEventListener("mouseleave",function(){h.style.display="none"}),f.addEventListener("click",function(e){if(e.preventDefault(),"[添加关注]"===f.innerHTML){let e=JSON.parse(localStorage.getItem("7ddata")).daily[0];5!==g.length?(g.push({name:S.innerHTML.slice(S.innerHTML.lastIndexOf(",")+1),code:m.code,data:{weatherName:e.textDay,Max:e.tempMax,Min:e.tempMin,icon:e.iconDay}}),f.innerHTML="[已关注]",f.style.cursor="default",localStorage.setItem("arrConcern",JSON.stringify(y))):h.style.display="inline-block"}}),document.querySelector(".concern ul").addEventListener("click",function(e){if("P"===e.target.tagName){let t=e.target.parentElement;m.code!==Number(t.dataset.code)&&(m.code=Number(t.dataset.code),S.innerHTML=e.target.parentElement.firstElementChild.firstElementChild.innerHTML)}if("set_default"===e.target.className){const t=e.target.parentElement.firstElementChild;localStorage.setItem("default_last",JSON.stringify({name:t.innerHTML,code:Number(e.target.parentElement.parentElement.dataset.code)}))}if("delete_concern"===e.target.className){let t=Number(e.target.parentElement.dataset.code);for(let e=0;e<g.length;e++)Number(g[e].code)===t&&(delete g[e],y.splice(e,1),localStorage.setItem("arrConcern",JSON.stringify(y)));e.target.parentElement.remove()}}),document.querySelector(".btn").addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(".history");localStorage.removeItem("historydata"),t.style.display="none"}),document.querySelector(".nav_p").innerHTML=r.name,v()})();